{% extends "base.html" %}

{% block title %}{{ t.cv_parsing.review_title }} - {{ t.app_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <h2>{{ t.cv_parsing.review_title }}</h2>
    <a href="{{ url_for('parse_cv') }}" class="btn btn-secondary">{{ t.cv_parsing.back_to_upload }}</a>
</div>

<div class="info-section">
    <h3>{{ t.cv_parsing.extracted_data_title }}</h3>
    <p>{{ t.cv_parsing.review_instructions }}</p>
</div>

<div class="review-grid">
    <!-- Personal Information -->
    {% if parsed_data.personal_info %}
    <div class="review-card">
        <h3>{{ t.personal_info.title }}</h3>
        <div class="review-content">
            {% if parsed_data.personal_info.first_name or parsed_data.personal_info.last_name %}
            <p><strong>{{ t.personal_info.name }}:</strong> {{ parsed_data.personal_info.first_name }} {{ parsed_data.personal_info.last_name }}</p>
            {% endif %}
            {% if parsed_data.personal_info.email %}
            <p><strong>{{ t.personal_info.email }}:</strong> {{ parsed_data.personal_info.email }}</p>
            {% endif %}
            {% if parsed_data.personal_info.phone %}
            <p><strong>{{ t.personal_info.phone }}:</strong> {{ parsed_data.personal_info.phone }}</p>
            {% endif %}
            {% if parsed_data.personal_info.address %}
            <p><strong>{{ t.personal_info.address }}:</strong> {{ parsed_data.personal_info.address }}</p>
            {% endif %}
            {% if parsed_data.personal_info.summary %}
            <p><strong>{{ t.personal_info.summary }}:</strong> {{ parsed_data.personal_info.summary | truncate(200) }}</p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Work Experience -->
    {% if parsed_data.work_experience %}
    <div class="review-card">
        <h3>{{ t.work_experience.title }} ({{ parsed_data.work_experience | length }})</h3>
        <div class="review-content">
            {% for exp in parsed_data.work_experience[:3] %}
            <div class="review-item" style="border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin-bottom: 0.5rem;">
                <strong>{{ exp.job_title }}</strong> at {{ exp.company_name }}<br>
                <small>{{ exp.start_date }} - {{ exp.end_date or t.cv_parsing.current }}</small>
                {% if exp.description %}
                    <p style="margin: 0.25rem 0; font-size: 0.85rem; color: var(--text-secondary);">
                        {{ exp.description | truncate(100) }}
                    </p>
                {% endif %}
                {% if exp.star_situation or exp.star_tasks or exp.star_actions or exp.star_results %}
                    <div style="margin-top: 0.25rem; font-size: 0.75rem; color: var(--primary-color);">
                        [S.T.A.R. Data Extracted]
                    </div>
                {% endif %}
            </div>
            {% endfor %}
            {% if parsed_data.work_experience | length > 3 %}
            <p><small>{{ t.cv_parsing.and_more.format(count=parsed_data.work_experience | length - 3) }}</small></p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Education -->
    {% if parsed_data.education %}
    <div class="review-card">
        <h3>{{ t.education.title }} ({{ parsed_data.education | length }})</h3>
        <div class="review-content">
            {% for edu in parsed_data.education[:3] %}
            <div class="review-item">
                <strong>{{ edu.degree }}</strong> in {{ edu.field_of_study }}<br>
                <small>{{ edu.institution }}</small>
            </div>
            {% endfor %}
            {% if parsed_data.education | length > 3 %}
            <p><small>{{ t.cv_parsing.and_more.format(count=parsed_data.education | length - 3) }}</small></p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Skills -->
    {% if parsed_data.skills %}
    <div class="review-card">
        <h3>{{ t.skills.title }} ({{ parsed_data.skills | length }})</h3>
        <div class="review-content">
            {% for skill in parsed_data.skills[:6] %}
            <span class="skill-tag">{{ skill.name }}</span>
            {% endfor %}
            {% if parsed_data.skills | length > 6 %}
            <p><small>{{ t.cv_parsing.and_more.format(count=parsed_data.skills | length - 6) }}</small></p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Projects -->
    {% if parsed_data.projects %}
    <div class="review-card">
        <h3>{{ t.projects.title }} ({{ parsed_data.projects | length }})</h3>
        <div class="review-content">
            {% for project in parsed_data.projects[:3] %}
            <div class="review-item">
                <strong>{{ project.name }}</strong><br>
                <small>{{ project.description | truncate(100) if project.description }}</small>
            </div>
            {% endfor %}
            {% if parsed_data.projects | length > 3 %}
            <p><small>{{ t.cv_parsing.and_more.format(count=parsed_data.projects | length - 3) }}</small></p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Certifications -->
    {% if parsed_data.certifications %}
    <div class="review-card">
        <h3>{{ t.certifications.title }} ({{ parsed_data.certifications | length }})</h3>
        <div class="review-content">
            {% for cert in parsed_data.certifications[:3] %}
            <div class="review-item">
                <strong>{{ cert.name }}</strong><br>
                <small>{{ cert.issuing_organization }}</small>
            </div>
            {% endfor %}
            {% if parsed_data.certifications | length > 3 %}
            <p><small>{{ t.cv_parsing.and_more.format(count=parsed_data.certifications | length - 3) }}</small></p>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

{% if cv_text_preview %}
<details class="cv-preview">
    <summary>{{ t.cv_parsing.original_text_preview }}</summary>
    <pre class="cv-text">{{ cv_text_preview }}</pre>
</details>
{% endif %}

<div class="form-actions">
    <form method="POST" action="{{ url_for('import_parsed_cv') }}" style="display: inline;">
        <button type="submit" class="btn btn-primary">{{ t.cv_parsing.import_button }}</button>
    </form>
    <a href="{{ url_for('parse_cv') }}" class="btn btn-secondary">{{ t.cv_parsing.try_again }}</a>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-link">{{ t.buttons.cancel }}</a>
</div>
{% endblock %}