{% extends "base.html" %}

{% block title %}{{ t.consultants.import_title }} - {{ t.app_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <h2>{{ t.consultants.import_title }}</h2>
    <a href="{{ url_for('list_consultants') }}" class="btn btn-secondary">{{ t.consultants.back_button }}</a>
</div>

<form method="POST" enctype="multipart/form-data" class="form">
    <div class="form-section">
        <div class="form-group">
            <label>{{ t.consultants.import_mode }}</label>
            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="import_mode" value="existing" {% if consultants %}checked{% else %}disabled{% endif %}>
                    {{ t.consultants.import_existing }}
                </label>
                <label class="radio-option">
                    <input type="radio" name="import_mode" value="new" {% if not consultants %}checked{% endif %}>
                    {{ t.consultants.import_new }}
                </label>
            </div>
        </div>

        <div class="form-group" id="existingConsultantGroup" {% if not consultants %}style="display: none;"{% endif %}>
            <label for="consultant_id">{{ t.consultants.select_consultant }}</label>
            <select id="consultant_id" name="consultant_id">
                {% for consultant in consultants %}
                    <option value="{{ consultant['id'] }}" {% if current_consultant and consultant['id'] == current_consultant['id'] %}selected{% endif %}>
                        {{ consultant['display_name'] }}
                    </option>
                {% endfor %}
            </select>
            <small>{{ t.consultants.import_replace_hint }}</small>
        </div>

        <div class="form-group" id="newConsultantGroup" {% if consultants %}style="display: none;"{% endif %}>
            <label for="display_name">{{ t.consultants.display_name }}</label>
            <input type="text" id="display_name" name="display_name" placeholder="{{ t.consultants.display_name_placeholder }}">
            <small>{{ t.consultants.import_name_hint }}</small>
        </div>

        <div class="form-group">
            <label>{{ t.consultants.import_file }}</label>
            <div style="margin-bottom: 1rem; padding: 1rem; background-color: var(--background); border-radius: 6px; border: 1px solid var(--border-color);">
                <p style="margin: 0 0 1rem 0; color: var(--text-secondary); font-size: 0.875rem;">{{ t.messages.import_json_or_upload }}</p>
                
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="json_textarea">{{ t.messages.import_json_paste }}</label>
                    <textarea id="json_textarea" name="json_textarea" placeholder="{{ t.messages.import_json_placeholder }}" style="font-family: 'Courier New', monospace; font-size: 0.85rem; min-height: 200px;">{% if prefilled_json %}{{ prefilled_json }}{% endif %}</textarea>
                    <small>{{ t.messages.import_json_paste_hint }}</small>
                </div>
                
                <div style="text-align: center; color: var(--text-secondary); font-size: 0.875rem; margin: 1rem 0;">— {{ t.messages.import_or }} —</div>
                
                <div class="form-group">
                    <label for="json_file">{{ t.messages.import_upload_file }}</label>
                    <input type="file" id="json_file" name="json_file" accept="application/json">
                    <small>{{ t.messages.import_file_hint }}</small>
                </div>
            </div>
        </div>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">{{ t.consultants.import_button }}</button>
        <a href="{{ url_for('list_consultants') }}" class="btn btn-secondary">{{ t.buttons.cancel }}</a>
    </div>
</form>

<script>
    function toggleImportMode() {
        var existingGroup = document.getElementById('existingConsultantGroup');
        var newGroup = document.getElementById('newConsultantGroup');
        var selected = document.querySelector('input[name="import_mode"]:checked');
        if (!selected) {
            return;
        }
        if (selected.value === 'existing') {
            existingGroup.style.display = 'block';
            newGroup.style.display = 'none';
        } else {
            existingGroup.style.display = 'none';
            newGroup.style.display = 'block';
        }
    }

    var radios = document.querySelectorAll('input[name="import_mode"]');
    radios.forEach(function (radio) {
        radio.addEventListener('change', toggleImportMode);
    });
    toggleImportMode();
</script>
{% endblock %}
